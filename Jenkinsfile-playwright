node("kaniko-agent") {
    try {
        // Checkout the repository
        stage('Checkout SCM') {
            checkout scm
        }

        // Clone the repository using Python script
        stage('Repo Clone') {
            container('playwright') {
                withCredentials([usernamePassword(credentialsId: 'Pratham-GH', usernameVariable: 'GIT_UNAME', passwordVariable: 'GIT_PASSWD')]) {
                    script {
                        echo "Cloning repository with provided details..."
                        sh '''
                            python3 /playwright/allure_repoclone.py \
                                --repo_url=${GIT_URL} \
                                --branch=${GIT_BRANCH} \
                                --pat=$GIT_PASSWD
                        '''
                    }
                }
            }
        }
    } catch (Exception e) {
        echo "An error occurred: ${e.getMessage()}"
        currentBuild.result = 'FAILURE'
        throw e
    } finally {
        echo "Pipeline completed."
    }
}

